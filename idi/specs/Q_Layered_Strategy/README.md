# Q Layered Strategy (Ported)

This spec ports `tau_q_agents/phase4/16_layered_strategy.tau` to the new Tau 0.7.0-alpha file-based I/O model.  It preserves the original multi-layer voting logic while adopting IDI conventions (input mirrors, local `inputs/` + `outputs/` folders, deterministic sample streams).

## Streams

| Name | Type | Description |
|------|------|-------------|
| `price_up` / `price_down` | `sbf` | Binary price-direction bits (generated by `TraceBatch.export`). |
| `weight_momentum` / `weight_contra` / `weight_trend` | `sbf` | Layer-selector gates emitted by the trainer (1 = trust that layer). |
| `buy_signal` / `sell_signal` | `sbf` | Final action outputs. |
| `position` | `sbf` | Internal position bit. |
| `momentum_vote` / `contrarian_vote` / `trend_vote` | `sbf` | Layer votes (mirrored for tracing). |
| `*_echo` | `sbf` | Mirrors for every input stream (Tau symmetry requirement). |

## Usage

1. Train lookup tables with the existing devkit plan:
   ```
   python -m idi.devkit.build_layers --plan idi/devkit/configs/layer_plan.json
   ```
   The `layered-demo` entry copies the generated `price_*` and `weight_*` streams directly into `idi/specs/Q_Layered_Strategy/inputs/`.
2. Run the spec with the current Tau binary:
   ```
   tau_daemon_alpha/bin/tau idi/specs/Q_Layered_Strategy/agent_layered_strategy.tau
   ```
3. Inspect the `outputs/` folder for mirrored inputs + layer votes.

## Differences vs. the legacy spec

- Pure file-based IO (`name : sbf = in/out file(...)`) plus dedicated folders so demos can run without manual setup.
- Explicit mirrors for each input (fixes the “Failed to find output stream” runtime error).
- Comments + spacing to keep clause count readable.
- Generated weight streams follow the same weighting scheme as the phase5/phase6 Q-daemons, making it easy to compare old/new pipelines.

